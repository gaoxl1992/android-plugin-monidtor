# å¿«é€Ÿå¼€å§‹ - Android é€šçŸ¥ç›‘å¬æ’ä»¶

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿé›†æˆ

### æ­¥éª¤ 1ï¼šå®‰è£…æ’ä»¶

åœ¨ HBuilderX ä¸­å¯¼å…¥æ’ä»¶åˆ° `nativeplugins` ç›®å½•ï¼Œæˆ–ä»æ’ä»¶å¸‚åœºè´­ä¹°ã€‚

### æ­¥éª¤ 2ï¼šé…ç½® manifest.json

æ— éœ€é¢å¤–é…ç½®ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ·»åŠ æ‰€éœ€æƒé™ã€‚

### æ­¥éª¤ 3ï¼šä½¿ç”¨æ’ä»¶

```javascript
// 1. å¼•å…¥æ’ä»¶
const notificationModule = uni.requireNativePlugin('OtcNotificationListener');

// 2. æ£€æŸ¥å¹¶ç”³è¯·æƒé™
if (!notificationModule.checkPermission()) {
  uni.showModal({
    title: 'éœ€è¦æˆæƒ',
    content: 'è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¼€å¯é€šçŸ¥ä½¿ç”¨æƒé™',
    confirmText: 'å»è®¾ç½®',
    success: (res) => {
      if (res.confirm) {
        notificationModule.openSettings();
      }
    }
  });
} else {
  // 3. å¼€å§‹ç›‘å¬
  notificationModule.startListening((data) => {
    console.log('æ”¶åˆ°é€šçŸ¥ï¼š');
    console.log('åº”ç”¨ï¼š', data.packageName);
    console.log('æ ‡é¢˜ï¼š', data.title);
    console.log('å†…å®¹ï¼š', data.text);
    
    // ä½ çš„ä¸šåŠ¡é€»è¾‘
    // æ¯”å¦‚ï¼šè¿‡æ»¤å¾®ä¿¡é€šçŸ¥ã€ä¿å­˜åˆ°æ•°æ®åº“ã€æ˜¾ç¤ºæç¤ºç­‰
  });
}

// 4. ä¸éœ€è¦æ—¶åœæ­¢ï¼ˆå¯é€‰ï¼‰
// notificationModule.stopListening();
```

### æ­¥éª¤ 4ï¼šæ‰“åŒ…æµ‹è¯•

- åˆ¶ä½œè‡ªå®šä¹‰åŸºåº§ï¼šè¿è¡Œ -> è¿è¡Œåˆ°æ‰‹æœºæˆ–æ¨¡æ‹Ÿå™¨ -> åˆ¶ä½œè‡ªå®šä¹‰è°ƒè¯•åŸºåº§
- æˆ–è€…ï¼šå‘è¡Œ -> åŸç”ŸApp-äº‘æ‰“åŒ…

## ğŸ“± å®Œæ•´ç¤ºä¾‹é¡µé¢

```vue
<template>
  <view class="page">
    <button @click="checkAndStart">å¼€å§‹ç›‘å¬é€šçŸ¥</button>
    <button @click="stop">åœæ­¢ç›‘å¬</button>
    
    <view class="logs">
      <text v-for="(log, i) in logs" :key="i">{{ log }}</text>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      module: null,
      logs: []
    }
  },
  
  onLoad() {
    this.module = uni.requireNativePlugin('OtcNotificationListener');
  },
  
  methods: {
    checkAndStart() {
      if (!this.module.checkPermission()) {
        uni.showModal({
          title: 'éœ€è¦æƒé™',
          content: 'è¯·å¼€å¯é€šçŸ¥ç›‘å¬æƒé™',
          confirmText: 'å»è®¾ç½®',
          success: (res) => {
            if (res.confirm) {
              this.module.openSettings();
            }
          }
        });
        return;
      }
      
      this.module.startListening((data) => {
        this.logs.unshift(`${data.packageName}: ${data.title} - ${data.text}`);
        if (this.logs.length > 20) this.logs.pop();
      });
      
      uni.showToast({ title: 'å¼€å§‹ç›‘å¬', icon: 'success' });
    },
    
    stop() {
      this.module.stopListening();
      uni.showToast({ title: 'å·²åœæ­¢', icon: 'success' });
    }
  }
}
</script>

<style scoped>
.page {
  padding: 20px;
}

button {
  margin-bottom: 10px;
}

.logs {
  margin-top: 20px;
  padding: 10px;
  background: #f5f5f5;
}

text {
  display: block;
  margin-bottom: 5px;
  font-size: 12px;
}
</style>
```

## ğŸ¯ æ ¸å¿ƒ API é€ŸæŸ¥

| API | è¯´æ˜ | è¿”å›å€¼ |
|-----|------|--------|
| `checkPermission()` | æ£€æŸ¥æ˜¯å¦æœ‰æƒé™ | Boolean |
| `openSettings()` | æ‰“å¼€ç³»ç»Ÿè®¾ç½®é¡µ | - |
| `startListening(callback)` | å¼€å§‹ç›‘å¬ | - |
| `stopListening()` | åœæ­¢ç›‘å¬ | - |
| `isServiceRunning()` | æ£€æŸ¥æœåŠ¡çŠ¶æ€ | Boolean |

## ğŸ“ å›è°ƒæ•°æ®æ ¼å¼

```javascript
{
  packageName: "com.tencent.mm",  // åº”ç”¨åŒ…å
  title: "å¾®ä¿¡",                  // é€šçŸ¥æ ‡é¢˜
  text: "ä½ æ”¶åˆ°ä¸€æ¡æ–°æ¶ˆæ¯",        // é€šçŸ¥å†…å®¹
  timestamp: 1702800000000        // æ—¶é—´æˆ³
}
```

## âš ï¸ é‡è¦æç¤º

1. **å¿…é¡»åœ¨çœŸæœºä¸Šæµ‹è¯•**ï¼ˆæ¨¡æ‹Ÿå™¨å¯èƒ½ä¸æ”¯æŒï¼‰
2. **ç”¨æˆ·å¿…é¡»æ‰‹åŠ¨æˆæƒ**ï¼ˆç³»ç»Ÿè®¾ç½® -> é€šçŸ¥ä½¿ç”¨æƒï¼‰
3. **éµå®ˆéšç§æ”¿ç­–**ï¼ˆåœ¨éšç§åè®®ä¸­è¯´æ˜ç”¨é€”ï¼‰
4. **ä»…æ”¯æŒ Android**ï¼ˆiOS ä¸æ”¯æŒé€šçŸ¥ç›‘å¬ï¼‰

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ²¡æœ‰æ”¶åˆ°é€šçŸ¥ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
```javascript
// 1. æ£€æŸ¥æƒé™
console.log('æƒé™:', this.module.checkPermission());

// 2. æ£€æŸ¥æœåŠ¡
console.log('æœåŠ¡:', this.module.isServiceRunning());

// 3. å¦‚æœæƒé™æœ‰ä½†æœåŠ¡æ²¡è¿è¡Œï¼Œé‡å¯åº”ç”¨
```

### Q: å¦‚ä½•åªç›‘å¬å¾®ä¿¡é€šçŸ¥ï¼Ÿ

A: åœ¨å›è°ƒä¸­è¿‡æ»¤ï¼š
```javascript
this.module.startListening((data) => {
  if (data.packageName === 'com.tencent.mm') {
    // å¤„ç†å¾®ä¿¡é€šçŸ¥
  }
});
```

### Q: åº”ç”¨åå°ä¼šè¢«æ€æ­»å—ï¼Ÿ

A: éƒ¨åˆ†å‚å•†ä¼šæ€æ­»åå°æœåŠ¡ï¼Œå»ºè®®ï¼š
- å¼•å¯¼ç”¨æˆ·å…³é—­çœç”µä¼˜åŒ–
- æ·»åŠ åˆ°ç™½åå•
- è®¾ç½®è‡ªå¯åŠ¨

---

æ›´å¤šè¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ [README.md](./README.md)

